<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="">
    <select id="getRefTable" resultType="String">
        select concat(db_name, '.', tb_name) as ref_table
        from tb_info;
    </select>
    <select id="getRefColumn" resultType="String">
        select col_name
        from column_info
        where tb_id = (select tb_id from tb_info where concat(db_name, '.', tb_name) = #{ref_table})
          and (PK = true or uni = true);
    </select>
    <update id="addFk">
        alter table ${db_name}.${tb_name}
            add foreign key ${fk_name} (${fk_column}) references ${ref_table} ($(ref_column));
    </update>
    <insert id="insertFkInfo">
        insert into fk_info
        values (#{ref_table}, #{fk_name}, #{fk_column}, #{ref_table}, #{ref_column});
    </insert>
    <update id="deleteFk">
        alter table ${db_name}.${tb_name}
            drop foreign key ${fk_name};
    </update>
    <delete id="deleteFkInfo">
        delete
        from fk_info
        where fk_table = #{fk_table}
          and fk_column = #{fk_column};
    </delete>
    <select id="queryRefTable" resultType="String">
        select *from ${table};
    </select>
</mapper>