<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gxu.informationLibrary.dao.formManageDao">
    <resultMap id="formTableMap" type="com.gxu.informationLibrary.entity.formTable">
        <result column="form_id" property="form_id"/>
        <result column="form_name" property="form_name"/>
        <result column="tb_name" property="tb_name"/>
    </resultMap>
    <select id="query" resultMap="formTableMap">
        select form_id, form_name, concat(db_name, '.', tb_name) as tb_name
        from form_info,
             tb_info
        where form_info.tb_id in (select tb_id from tb_info where tb_name like concat('%', #{tb_name}, '%'));
    </select>
    <update id="renameForm">
        update form_info
        set form_name=#{new_name}
        where form_id = #{form_id};
    </update>
    <resultMap id="formStructMap" type="com.gxu.informationLibrary.entity.formStruct">
        <result column="form_id" property="form_id"/>
        <result column="col_name" property="col_name"/>
        <result column="label_name" property="label_name"/>
    </resultMap>
    <select id="getFormStruct" resultMap="formStructMap">
        select form_id, label_name, col_name
        from form_struct,
             column_info
        where form_struct.form_id = #{form_id}
          and form_struct.col_id = column_info.col_id;
    </select>
    <update id="editForm">
        <foreach collection="formStructList" item="item" index="index">
            update form_struct set label_name=#{item.label_name} where col_id=(select col_id from column_info where
            tb_id=(select tb_id from form_info where form_info.form_id=#{item.form_id}));
        </foreach>
    </update>
</mapper>