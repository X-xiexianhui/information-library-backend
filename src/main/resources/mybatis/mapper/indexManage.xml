<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gxu.informationLibrary.dao.indexManageDao">
    <select id="getColumns" resultType="String">
        select col_name
        from column_info
        where tb_id = (select tb_id from tb_info where db_name = #{db_name} and tb_name = #{tb_name});
    </select>
    <update id="dropIndex">
        alter table ${db_name}.${tb_name}
            drop index #{index_name};
    </update>
    <update id="addIndex">
        <foreach collection="insertions" item="insertion" index="index">
            create <if test="insertion.uni==true">unique</if> index #{insertion.index_name} on ${db_name}.${db_name) (
            <foreach collection="insertion.fields" index="index" item="field" separator=",">
                ${field}
            </foreach>
            );
        </foreach>
    </update>
    <resultMap id="indexList" type="com.gxu.informationLibrary.entity.index">
        <result column="index_name" property="index_name"/>
        <result column="uni" property="uni"/>
        <collection property="fields" ofType="string" javaType="java.util.List">
            <result column="col_name" property="col_name"/>
        </collection>
    </resultMap>
    <select id="getIndex" resultType="indexList">
        select  index_name,col_name, uni
        from index_info
        where tb_id = (select tb_id from tb_info where tb_name = #{tb_name} and db_name = #{db_name});
    </select>
    <select id="getIndexName" resultType="String">
        select index_name from index_info where index_id=#{index_id};
    </select>
</mapper>