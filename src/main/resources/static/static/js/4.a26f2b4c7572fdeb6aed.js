webpackJsonp([4,9],{"5zde":function(e,t,a){a("zQR9"),a("qyJz"),e.exports=a("FeBl").Array.from},Gu7T:function(e,t,a){"use strict";t.__esModule=!0;var r,n=a("c/Tr"),o=(r=n)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return(0,o.default)(e)}},L8DL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),n=a.n(r),o=a("exGp"),s=a.n(o),i=a("RwfU"),u=a("mtWM"),c=a.n(u),l={name:"formList",data:function(){return{toolBarConfig:{slots:{buttons:"toolbar_buttons"}},form_name:"",dialogVisible:!1,searchName:"",tablePage:{currentPage:1,pageSize:10},tableColumn:[{field:"tb_name",title:"数据表"},{field:"form_name",title:"表单名称"}],tableData:[]}},created:function(){this.query("")},methods:{query:function(e){var t=this;return s()(n.a.mark(function a(){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$http.get("/api/form/list",{params:{tb_name:e}});case 3:200!==(r=a.sent).data.code?Object(i.a)(r.data.msg):t.tableData=r.data.data,a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),Object(i.a)(a.t0);case 10:case"end":return a.stop()}},a,t,[[0,7]])}))()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.tablePage.currentPage=t,this.tablePage.pageSize=a},renameEvent:function(){var e=this.$refs.formTable.getCurrentRecord();if(console.log(e),!e)return Object(i.a)("请先选择需要重命名的表单");this.dialogVisible=!0},closeEvent:function(){this.dialogVisible=!1,this.form_name=""},save:function(){var e=this;return s()(n.a.mark(function t(){var a,r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==e.form_name){t.next=2;break}return t.abrupt("return",Object(i.a)("请输入表单名称"));case 2:return t.prev=2,a=e.$refs.formTable.getCurrentRecord(),t.next=6,c.a.post("/api/form/rename",{old_name:a.form_name,new_name:e.form_name,form_id:a.form_id});case 6:200!==(r=t.sent).data.code?Object(i.a)(r.data.msg):(e.tableData=r.data.data,e.closeEvent()),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),Object(i.a)(t.t0.message);case 13:case"end":return t.stop()}},t,e,[[2,10]])}))()},goToEdit:function(){var e=this.$refs.formTable.getCurrentRecord();console.log(e);var t=this.$router.resolve({path:"/form/edit",query:{form_id:e.form_id}});window.open(t.href,"_blank")}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("vxe-grid",{ref:"formTable",attrs:{border:"",resizable:"","toolbar-config":e.toolBarConfig,"row-config":{isCurrent:!0},columns:e.tableColumn,data:e.tableData},scopedSlots:e._u([{key:"toolbar_buttons",fn:function(){return[a("vxe-input",{attrs:{placeholder:"请输入数据表名称",clearable:""},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),e._v(" "),a("vxe-button",{attrs:{status:"primary"},on:{click:function(t){return e.query(e.searchName)}}},[e._v("搜索")]),e._v(" "),a("vxe-button",{attrs:{status:"success"},on:{click:e.renameEvent}},[e._v("重命名")]),e._v(" "),a("vxe-button",{attrs:{status:"success"},on:{click:e.goToEdit}},[e._v("修改表单")]),e._v(" "),a("vxe-button",{on:{click:function(t){return e.$refs.formTable.exportData()}}},[e._v("导出")])]},proxy:!0},{key:"pager",fn:function(){return[a("vxe-pager",{attrs:{layouts:["Sizes","PrevJump","PrevPage","Number","NextPage","NextJump","FullJump","Total"],"current-page":e.tablePage.currentPage,"page-size":e.tablePage.pageSize,total:e.tableData.length},on:{"update:currentPage":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:current-page":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.tablePage,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tablePage,"pageSize",t)},"page-change":e.handlePageChange}})]},proxy:!0}])}),e._v(" "),a("el-dialog",{staticStyle:{width:"70%",margin:"auto"},attrs:{title:"请输入表单新名称",visible:e.dialogVisible,"before-close":e.closeEvent},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-input",{attrs:{placeholder:"请输入表单名称，支持中英文"},model:{value:e.form_name,callback:function(t){e.form_name=t},expression:"form_name"}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeEvent}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(l,f,!1,function(e){a("Xzyv")},"data-v-6b2a8236",null).exports,g={name:"formPage",components:{PageHead:a("Neex").a,FormList:d}},p={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("page-head",{staticClass:"nav"}),this._v(" "),t("el-container",[t("el-card",[t("form-list",{staticStyle:{width:"80%",margin:"auto"}})],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(g,p,!1,function(e){a("Of+j")},"data-v-734113c1",null);t.default=m.exports},"NB+V":function(e,t){},"Of+j":function(e,t){},Xzyv:function(e,t){},"c/Tr":function(e,t,a){e.exports={default:a("5zde"),__esModule:!0}},fBQ2:function(e,t,a){"use strict";var r=a("evD5"),n=a("X8DO");e.exports=function(e,t,a){t in e?r.f(e,t,n(0,a)):e[t]=a}},hBBL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Neex"),n=a("L8DL"),o=a("Xxa5"),s=a.n(o),i=a("exGp"),u=a.n(i),c=a("Gu7T"),l=a.n(c),f=a("mtWM"),d=a.n(f),g=a("RwfU"),p=a("Er6Z"),m={name:"editForm",data:function(){return{toolBarConfig:{slots:{buttons:"toolbar_buttons"}},searchName:"",tablePage:{currentPage:1,pageSize:10},tableColumn:[{field:"col_name",title:"数据表字段",editRender:{},slots:{edit:"colName_edit"}},{field:"label_name",title:"字段标签",editRender:{},slots:{edit:"formLabel_edit"}}],currentData:[],tableData:[],update:[],validRules:{label_name:[{required:!0,message:"字段标签必填"}]}}},created:function(){this.query(this.$route.query.form_id)},methods:{handlePageChange:function(e){var t,a=e.currentPage,r=e.pageSize,n=this.$refs.formStruct.getRecordset(),o=n.insertRecords,s=n.removeRecords,i=n.updateRecords;(o.reverse(),s.reverse(),i.length>0)&&(t=this.update).push.apply(t,l()(i));this.tablePage.currentPage=a,this.tablePage.pageSize=r,this.currentData=this.tableData.slice((a-1)*r,r*a)},query:function(e){var t=this;return u()(s.a.mark(function a(){var r,n;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d.a.get("/api/form/struct",{params:{form_id:e}});case 3:200!==(r=a.sent).data.code?Object(p.a)(r.data):(t.tableData=r.data.data,n=t.tablePage.pageSize,t.currentData=t.tableData.slice(0,n)),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),Object(g.a)(a.t0.message);case 10:case"end":return a.stop()}},a,t,[[0,7]])}))()},save:function(){var e=this;return u()(s.a.mark(function t(){var a,r,n,o,i,u,c,f,m;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.$refs.formStruct,r=a.getRecordset(),n=r.insertRecords,o=r.removeRecords,i=r.updateRecords,n.reverse(),o.reverse(),i.length>0&&(u=e.update).push.apply(u,l()(i)),0!==e.update.length){t.next=7;break}return t.abrupt("return",Object(g.a)("请先修改，再保存"));case 7:return t.prev=7,t.next=10,d.a.post("/api/form/edit",{update:e.update,form_id:e.$route.query.form_id});case 10:200!==(c=t.sent).data.code?Object(p.a)(c.data):(e.$message.success("修改成功"),e.update=[],e.tableData=c.data.data.reverse(),f=e.tablePage.currentPage,m=e.tablePage.pageSize,e.currentData=e.tableData.slice((f-1)*m,m*f)),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(7),Object(g.a)(t.t0);case 17:case"end":return t.stop()}},t,e,[[7,14]])}))()}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vxe-grid",{ref:"formStruct",attrs:{border:"",resizable:"","keep-source":"","toolbar-config":e.toolBarConfig,"edit-rules":e.validRules,"edit-config":{trigger:"click",mode:"cell",showStatus:!0},"row-config":{isCurrent:!0},columns:e.tableColumn,data:e.currentData},scopedSlots:e._u([{key:"colName_edit",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.col_name))])]}},{key:"formLabel_edit",fn:function(t){var r=t.row;return[a("vxe-input",{attrs:{type:"text"},model:{value:r.label_name,callback:function(t){e.$set(r,"label_name",t)},expression:"row.label_name"}})]}},{key:"toolbar_buttons",fn:function(){return[a("vxe-button",{attrs:{status:"success"},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("vxe-button",{on:{click:function(t){return e.$refs.formStruct.exportData()}}},[e._v("导出")])]},proxy:!0},{key:"pager",fn:function(){return[a("vxe-pager",{attrs:{layouts:["Sizes","PrevJump","PrevPage","Number","NextPage","NextJump","FullJump","Total"],"current-page":e.tablePage.currentPage,"page-size":e.tablePage.pageSize,total:e.tableData.length},on:{"update:currentPage":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:current-page":function(t){return e.$set(e.tablePage,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.tablePage,"pageSize",t)},"update:page-size":function(t){return e.$set(e.tablePage,"pageSize",t)},"page-change":e.handlePageChange}})]},proxy:!0}])})},staticRenderFns:[]};var b={name:"editFormPage",components:{EditForm:a("VU/8")(m,v,!1,function(e){a("NB+V")},"data-v-04177ff0",null).exports,FormPage:n.default,PageHead:r.a}},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("page-head",{staticClass:"nav"}),this._v(" "),t("el-container",[t("el-card",[t("edit-form",{staticStyle:{width:"80%",margin:"auto"}})],1)],1)],1)},staticRenderFns:[]};var _=a("VU/8")(b,h,!1,function(e){a("nTQj")},"data-v-6395be58",null);t.default=_.exports},nTQj:function(e,t){},qyJz:function(e,t,a){"use strict";var r=a("+ZMJ"),n=a("kM2E"),o=a("sB3e"),s=a("msXi"),i=a("Mhyx"),u=a("QRG4"),c=a("fBQ2"),l=a("3fs2");n(n.S+n.F*!a("dY0y")(function(e){Array.from(e)}),"Array",{from:function(e){var t,a,n,f,d=o(e),g="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,b=0,h=l(d);if(v&&(m=r(m,p>2?arguments[2]:void 0,2)),void 0==h||g==Array&&i(h))for(a=new g(t=u(d.length));t>b;b++)c(a,b,v?m(d[b],b):d[b]);else for(f=h.call(d),a=new g;!(n=f.next()).done;b++)c(a,b,v?s(f,m,[n.value,b],!0):n.value);return a.length=b,a}})}});
//# sourceMappingURL=4.a26f2b4c7572fdeb6aed.js.map